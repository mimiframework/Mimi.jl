<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>4 Timesteps, Params, and Vars · Mimi.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Mimi.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/tutorial_main/">Tutorials Intro</a></li><li><a class="tocitem" href="../../tutorials/tutorial_1/">1 Install Mimi</a></li><li><a class="tocitem" href="../../tutorials/tutorial_2/">2 Run an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_3/">3 Modify an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_4/">4 Create a Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_5/">5 Monte Carlo + Sensitivity Analysis</a></li></ul></li><li><span class="tocitem">How-to Guides</span><ul><li><a class="tocitem" href="../howto_main/">How-to Guides Intro</a></li><li><a class="tocitem" href="../howto_1/">1 Construct + Run a Model</a></li><li><a class="tocitem" href="../howto_2/">2 Explore Results</a></li><li><a class="tocitem" href="../howto_3/">3 Monte Carlo + SA</a></li><li class="is-active"><a class="tocitem" href>4 Timesteps, Params, and Vars</a><ul class="internal"><li><a class="tocitem" href="#Timesteps-and-available-functions-1"><span>Timesteps and available functions</span></a></li><li><a class="tocitem" href="#DataType-specification-of-Parameters-and-Variables-1"><span>DataType specification of Parameters and Variables</span></a></li><li><a class="tocitem" href="#More-on-parameter-indices-1"><span>More on parameter indices</span></a></li><li><a class="tocitem" href="#Updating-an-external-parameter-1"><span>Updating an external parameter</span></a></li><li><a class="tocitem" href="#Using-NamedArrays-for-setting-parameters-1"><span>Using NamedArrays for setting parameters</span></a></li></ul></li><li><a class="tocitem" href="../howto_5/">5 Port to v0.5.0</a></li><li><a class="tocitem" href="../howto_6/">6 Port to v1.0.0</a></li></ul></li><li><span class="tocitem">Advanced How-to Guides</span><ul><li><a class="tocitem" href="../../howto_advanced/howto_adv_main/">Advanced How-to Guides Intro</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_buildinit/">Build and Init Functions</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_datumrefs/">Using Datum References</a></li></ul></li><li><span class="tocitem">Reference Guides</span><ul><li><a class="tocitem" href="../../ref/ref_main/">Reference Guides Intro</a></li><li><a class="tocitem" href="../../ref/ref_API/">Mimi API</a></li><li><a class="tocitem" href="../../ref/ref_structures/">Structures</a></li><li><a class="tocitem" href="../../ref/ref_structures_definitions/">Structures: Definitions</a></li><li><a class="tocitem" href="../../ref/ref_structures_instances/">Structures: Instances</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to Guides</a></li><li class="is-active"><a href>4 Timesteps, Params, and Vars</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>4 Timesteps, Params, and Vars</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mimiframework/Mimi.jl/blob/master/docs/src/howto/howto_4.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-Guide-4:-Work-with-Timesteps,-Parameters,-and-Variables-1"><a class="docs-heading-anchor" href="#How-to-Guide-4:-Work-with-Timesteps,-Parameters,-and-Variables-1">How-to Guide 4: Work with Timesteps, Parameters, and Variables</a><a class="docs-heading-anchor-permalink" href="#How-to-Guide-4:-Work-with-Timesteps,-Parameters,-and-Variables-1" title="Permalink"></a></h1><h2 id="Timesteps-and-available-functions-1"><a class="docs-heading-anchor" href="#Timesteps-and-available-functions-1">Timesteps and available functions</a><a class="docs-heading-anchor-permalink" href="#Timesteps-and-available-functions-1" title="Permalink"></a></h2><p>An <code>AbstractTimestep</code> i.e. a <code>FixedTimestep</code> or a <code>VariableTimestep</code> is a type defined within Mimi in &quot;src/time.jl&quot;. It is used to represent and keep track of time indices when running a model.</p><p>In the <code>run_timestep</code> functions which the user defines, it may be useful to use any of the following functions, where <code>t</code> is an <code>AbstractTimestep</code> object:</p><pre><code class="language-julia">is_first(t) # returns true or false, true if t is the first timestep to be run
is_last(t) # returns true or false, true if t is the last timestep to be run
gettime(t) # returns the year represented by timestep t</code></pre><p>There are also two helper types <code>TimestepValue</code> and <code>TimestepIndex</code> that can be used with comparison operators (<code>==</code>, <code>&lt;</code>, and <code>&gt;</code>) to check whether an <code>AbstractTimestep</code> <code>t</code> during the <code>run_timestep</code> function corresponds with a certain year or index number. For example:</p><pre><code class="language-julia">if t &gt; TimestepValue(2020)
  # run this code only for timesteps after the year 2020
end

if t == TimestepIndex(3)
  # run this code only during the third timestep
end</code></pre><p>See below for further discussion of the <code>TimestepValue</code> and <code>TimestepIndex</code> objects and how they should be used.</p><p>The API details for AbstractTimestep object <code>t</code> are as follows:</p><ul><li>you may index into a variable or parameter with <code>[t]</code> or <code>[t +/- x]</code> as usual</li><li>to access the time value of <code>t</code> (currently a year) as a <code>Number</code>, use <code>gettime(t)</code></li><li>useful functions for commonly used conditionals are <code>is_first(t)</code> and <code>is_last(t)</code></li><li>to access the index value of <code>t</code> as a <code>Number</code> representing the position in the time array, use <code>t.t</code>.  Users are encouraged to avoid this access, and instead use comparisons with <code>TimestepIndex</code> objects to check if an AbstractTimestep <code>t</code> corresponds with a specific index number, as described above.</li></ul><p>Indexing into a variable or parameter&#39;s <code>time</code> dimension with an <code>Integer</code> is deprecated and will soon error. Instead, users should take advantage of the <code>TimestepIndex</code> and <code>TimestepValue</code> types. For examples we will refer back to our component definition above, and repeated below.</p><pre><code class="language-julia">@defcomp MyComponentName begin
  regions = Index()

  A = Variable(index = [time])
  B = Variable(index = [time, regions])

  c = Parameter()
  d = Parameter(index = [time])
  e = Parameter(index = [time, regions])
  f = Parameter(index = [regions])

  function run_timestep(p, v, d, t)
    v.A[t] = p.c + p.d[t]
    for r in d.regions
      v.B[t, r] = p.f[r] * p.e[t, r]
    end
  end

end</code></pre><p><code>TimestepIndex</code> has one field, <code>index</code>, which refers to the absolute index in the parameter or variable array&#39;s <code>time</code> dimension. Thus, constructing a <code>TimestepIndex</code> is done by simply writing <code>TimestepIndex(index::Int)</code>. Looking back at our original component example one could modify the first line of <code>run_timestep</code> to always refer to the first timestep of <code>p.d</code> with the following. One may index into the <code>time</code> dimension with a single <code>TimestepIndex</code>, or an <code>Array</code> of them.</p><pre><code class="language-julia">v.A[t] = p.c + p.d[TimestepIndex(1)]</code></pre><p><code>TimestepValue</code> has two fields, <code>value</code> and <code>offset</code>, referring to the value within the <code>time</code> dimension and an optional <code>offset</code> from that <code>value</code>. Thus, constructing a <code>TimestepValue</code> is done either by writing <code>TimestepValue(value)</code>, with an implied offset of 0, or <code>TimestepValue(value, offset = i::Int)</code>, with an explicit offset of i. One may index into the <code>time</code> dimension with a single <code>TimestepValue</code>, or an <code>Array</code> of them. For example, you can use a <code>TimestepValue</code> to keep track of a baseline year.</p><pre><code class="language-julia">v.A[t] = p.c + p.d[TimestepValue(2000)]</code></pre><p>You may also use shorthand to create arrays of <code>TimestepIndex</code> using Colon syntax.</p><pre><code class="language-julia">TimestepIndex(1):TimestepIndex(10) # implicit step size of 1
TimestepIndex(1):2:TimestepIndex(10) # explicit step of type Int </code></pre><p>Both <code>TimestepIndex</code> and <code>TimestepArray</code> have methods to support addition and subtraction of integers.  Note that the addition or subtraction is relative to the definition of the <code>time</code> dimension, so while <code>TimestepIndex(1) + 1 == TimestepIndex(2)</code>, <code>TimestepValue(2000) + 1</code> could be equivalent to <code>TimestepValue(2001)</code> <strong>if</strong> 2001 is the next year in the time dimension, or <code>TimestepValue(2005)</code> if the array has a step size of 5. Hence adding or subtracting is relative to the definition of the <code>time</code> dimension. </p><h2 id="DataType-specification-of-Parameters-and-Variables-1"><a class="docs-heading-anchor" href="#DataType-specification-of-Parameters-and-Variables-1">DataType specification of Parameters and Variables</a><a class="docs-heading-anchor-permalink" href="#DataType-specification-of-Parameters-and-Variables-1" title="Permalink"></a></h2><p>By default, the Parameters and Variables defined by a user will be allocated storage arrays of type <code>Float64</code> when a model is constructed. This default &quot;number_type&quot; can be overriden when a model is created, with the following syntax:</p><pre><code class="language-none">m = Model(Int64)    # creates a model with default number type Int64</code></pre><p>But you can also specify individual Parameters or Variables to have different data types with the following syntax in a <code>@defcomp</code> macro:</p><pre><code class="language-none">@defcomp example begin
  p1 = Parameter{Bool}()                         # ScalarModelParameter that is a Bool
  p2 = Parameter{Bool}(index = [regions])        # ArrayModelParameter with one dimension whose eltype is Bool
  p3 = Parameter{Matrix{Int64}}()                # ScalarModelParameter that is a Matrix of Integers
  p4 = Parameter{Int64}(index = [time, regions]) # ArrayModelParameter with two dimensions whose eltype is Int64
end</code></pre><p>If there are &quot;index&quot;s listed in the Parameter definition, then it will be an <code>ArrayModelParameter</code> whose <code>eltype</code> is the type specified in the curly brackets. If there are no &quot;index&quot;s listed, then the type specified in the curly brackets is the actual type of the parameter value, and it will be represent by Mimi as a <code>ScalarModelParameter</code>.</p><h2 id="More-on-parameter-indices-1"><a class="docs-heading-anchor" href="#More-on-parameter-indices-1">More on parameter indices</a><a class="docs-heading-anchor-permalink" href="#More-on-parameter-indices-1" title="Permalink"></a></h2><p>As mentioned above, a parameter can have no index (a scalar), or one or multiple of the model&#39;s indexes. A parameter can also have an index specified in the following ways:</p><pre><code class="language-julia">@defcomp MyComponent begin
  p1 = Parameter(index=[4]) # an array of length 4
  p2 = Parameter{Array{Float64, 2}}() # a two dimensional array of unspecified length
end</code></pre><p>In both of these cases, the parameter&#39;s values are stored of as an array (p1 is one dimensional, and p2 is two dimensional). But with respect to the model, they are considered &quot;scalar&quot; parameters, simply because they do not use any of the model&#39;s indices (namely &#39;time&#39;, or &#39;regions&#39;).</p><h2 id="Updating-an-external-parameter-1"><a class="docs-heading-anchor" href="#Updating-an-external-parameter-1">Updating an external parameter</a><a class="docs-heading-anchor-permalink" href="#Updating-an-external-parameter-1" title="Permalink"></a></h2><p>When <code>set_param!</code> is called, it creates an external parameter by the name provided, and stores the provided scalar or array value. It is possible to later change the value associated with that parameter name using the functions described below. If the external parameter has a <code>:time</code> dimension, use the optional argument <code>update_timesteps=true</code> to indicate that the time keys (i.e., year labels) associated with the parameter should be updated in addition to updating the parameter values.</p><pre><code class="language-julia">update_param!(m, :ParameterName, newvalues) # update values only 
update_param!(m, :ParameterName, newvalues, update_timesteps=true) # also update time keys</code></pre><p>Note: <code>newvalues</code> must be the same size and type (or be able to convert to the type) of the old values stored in that parameter.</p><h4 id="Setting-parameters-with-a-dictionary-1"><a class="docs-heading-anchor" href="#Setting-parameters-with-a-dictionary-1">Setting parameters with a dictionary</a><a class="docs-heading-anchor-permalink" href="#Setting-parameters-with-a-dictionary-1" title="Permalink"></a></h4><p>In larger models it can be beneficial to set some of the external parameters using a dictionary of values. To do this, use the following function:</p><pre><code class="language-julia">set_leftover_params!(m, parameters)</code></pre><p>Where <code>parameters</code> is a dictionary of type <code>Dict{String, Any}</code> where the keys are strings that match the names of the unset parameters in the model, and the values are the values to use for those parameters.</p><h2 id="Using-NamedArrays-for-setting-parameters-1"><a class="docs-heading-anchor" href="#Using-NamedArrays-for-setting-parameters-1">Using NamedArrays for setting parameters</a><a class="docs-heading-anchor-permalink" href="#Using-NamedArrays-for-setting-parameters-1" title="Permalink"></a></h2><p>When a user sets a parameter, Mimi checks that the size and dimensions match what it expects for that component. If the user provides a NamedArray for the values, Mimi will further check that the names of the dimensions match the expected dimensions for that parameter, and that the labels match the model&#39;s index values for those dimensions. Examples of this can be found in &quot;test/test<em>parameter</em>labels.jl&quot;.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../howto_3/">« 3 Monte Carlo + SA</a><a class="docs-footer-nextpage" href="../howto_5/">5 Port to v0.5.0 »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 28 October 2020 21:08">Wednesday 28 October 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
