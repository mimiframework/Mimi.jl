<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Build and Init Functions · Mimi.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Mimi.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/tutorial_main/">Tutorials Intro</a></li><li><a class="tocitem" href="../../tutorials/tutorial_1/">1 Install Mimi</a></li><li><a class="tocitem" href="../../tutorials/tutorial_2/">2 Run an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_3/">3 Modify an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_4/">4 Create a Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_5/">5 Monte Carlo + Sensitivity Analysis</a></li><li><a class="tocitem" href="../../tutorials/tutorial_6/">6 Create a Model with Composite Components</a></li></ul></li><li><span class="tocitem">How-to Guides</span><ul><li><a class="tocitem" href="../../howto/howto_main/">How-to Guides Intro</a></li><li><a class="tocitem" href="../../howto/howto_1/">1 Construct + Run a Model</a></li><li><a class="tocitem" href="../../howto/howto_2/">2 Explore Results</a></li><li><a class="tocitem" href="../../howto/howto_3/">3 Monte Carlo + SA</a></li><li><a class="tocitem" href="../../howto/howto_4/">4 Timesteps</a></li><li><a class="tocitem" href="../../howto/howto_5/">5 Parameters + Variables</a></li><li><a class="tocitem" href="../../howto/howto_6/">6 Update Time Dimension</a></li><li><a class="tocitem" href="../../howto/howto_7/">7 Port to v0.5.0</a></li><li><a class="tocitem" href="../../howto/howto_8/">8 Port to v1.0.0</a></li><li><a class="tocitem" href="../../howto/howto_9/">9 Port to New Param API</a></li></ul></li><li><span class="tocitem">Advanced How-to Guides</span><ul><li><a class="tocitem" href="../howto_adv_main/">Advanced How-to Guides Intro</a></li><li class="is-active"><a class="tocitem" href>Build and Init Functions</a><ul class="internal"><li><a class="tocitem" href="#The-Internal-&#39;build&#39;-Function-and-Model-Instances-1"><span>The Internal &#39;build&#39; Function and Model Instances</span></a></li><li><a class="tocitem" href="#The-init-function-1"><span>The init function</span></a></li></ul></li><li><a class="tocitem" href="../howto_adv_datumrefs/">Using Datum References</a></li></ul></li><li><span class="tocitem">Reference Guides</span><ul><li><a class="tocitem" href="../../ref/ref_main/">Reference Guides Intro</a></li><li><a class="tocitem" href="../../ref/ref_API/">Mimi API</a></li><li><a class="tocitem" href="../../ref/ref_structures_classes_types/">Structures: Classes.jl and Types</a></li><li><a class="tocitem" href="../../ref/ref_structures_definitions/">Structures: Definitions</a></li><li><a class="tocitem" href="../../ref/ref_structures_instances/">Structures: Instances</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../../explanations/exp_main/">Explanations Intro</a></li><li><a class="tocitem" href="../../explanations/exp_pkgs/">Models as Packages</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advanced How-to Guides</a></li><li class="is-active"><a href>Build and Init Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Build and Init Functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mimiframework/Mimi.jl/blob/master/docs/src/howto_advanced/howto_adv_buildinit.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Advanced-How-to-Guide:-Build-and-Init-Functions-1"><a class="docs-heading-anchor" href="#Advanced-How-to-Guide:-Build-and-Init-Functions-1">Advanced How-to Guide: Build and Init Functions</a><a class="docs-heading-anchor-permalink" href="#Advanced-How-to-Guide:-Build-and-Init-Functions-1" title="Permalink"></a></h1><p>In some cases, it may be useful for a user to better understand the inner-workings of the internal <code>build</code> function, as well as the ModelInstance and ModelDef types. In addition, components with one-time computations irrespective of timesteps may lend themselves to the use of the optional <code>init</code> function, as described below.</p><h2 id="The-Internal-&#39;build&#39;-Function-and-Model-Instances-1"><a class="docs-heading-anchor" href="#The-Internal-&#39;build&#39;-Function-and-Model-Instances-1">The Internal &#39;build&#39; Function and Model Instances</a><a class="docs-heading-anchor-permalink" href="#The-Internal-&#39;build&#39;-Function-and-Model-Instances-1" title="Permalink"></a></h2><p>The structural definition of a Model is held in the mutable ModelDef, and then when you call the run function on your model, first the internal <code>build</code> function is called, which produces a ModelInstance, and then the ModelInstance is run. A model instance is an instantiated version of the model you have designed where all of the component constructors have been called and all of the data arrays have been allocated. If you wish to create and run multiple versions of your model, you can use the intermediate build function and store the separate ModelInstances. This may be useful if you want to change some parameter values, while keeping the model&#39;s structure mostly the same. For example:</p><pre><code class="language-julia">instance1 = Mimi.build(m)
run(instance1)

update_param!(m, ParameterName, newvalue)
instance2 = Mimi.build(m)
run(instance2)

result1 = instance1[:Comp, :Var]
result2 = instance2[:Comp, :Var]</code></pre><p>Note that you can retrieve values from a ModelInstance in the same way you index into a model.</p><h2 id="The-init-function-1"><a class="docs-heading-anchor" href="#The-init-function-1">The init function</a><a class="docs-heading-anchor-permalink" href="#The-init-function-1" title="Permalink"></a></h2><p>The <code>init</code> function can optionally be called within <a href="../../ref/ref_API/#Mimi.@defcomp"><code>@defcomp</code></a> and <strong>before</strong> <code>run_timestep</code>.  Similarly to <code>run_timestep</code>, this function is called with parameters <code>init(p, v, d)</code>, where the component state (defined by the first three arguments) has fields for the Parameters, Variables, and Dimensions of the component you defined.   </p><p>If defined for a specific component, this function will run <strong>before</strong> the timestep loop, and should only be used for parameters or variables without a time index e.g. to compute the values of scalar variables that only depend on scalar parameters. Note that when using <code>init</code>, it may be necessary to add special handling in the <code>run_timestep</code> function for the first timestep, in particular for difference equations.  A skeleton <a href="../../ref/ref_API/#Mimi.@defcomp"><code>@defcomp</code></a> script using both <code>run_timestep</code> and <code>init</code> would appear as follows:</p><pre><code class="language-julia">@defcomp component1 begin

    # First define the state this component will hold
    savingsrate = Parameter()

    # Second, define the (optional) init function for the component
    function init(p, v, d)
    end

    # Third, define the run_timestep function for the component
    function run_timestep(p, v, d, t)
    end

end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../howto_adv_main/">« Advanced How-to Guides Intro</a><a class="docs-footer-nextpage" href="../howto_adv_datumrefs/">Using Datum References »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 16 November 2021 01:57">Tuesday 16 November 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
