<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>3 Modify an Existing Model · Mimi.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Mimi.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorial_main/">Tutorials Intro</a></li><li><a class="tocitem" href="../tutorial_1/">1 Install Mimi</a></li><li><a class="tocitem" href="../tutorial_2/">2 Run an Existing Model</a></li><li class="is-active"><a class="tocitem" href>3 Modify an Existing Model</a><ul class="internal"><li><a class="tocitem" href="#Introduction-1"><span>Introduction</span></a></li><li><a class="tocitem" href="#Parametric-Modifications:-The-API-1"><span>Parametric Modifications: The API</span></a></li><li><a class="tocitem" href="#Parametric-Modifications:-DICE-Example-1"><span>Parametric Modifications: DICE Example</span></a></li><li><a class="tocitem" href="#Component-and-Structural-Modifications:-The-API-1"><span>Component and Structural Modifications: The API</span></a></li><li><a class="tocitem" href="#Component-and-Structural-Modifications:-DICE-Example-1"><span>Component and Structural Modifications: DICE Example</span></a></li></ul></li><li><a class="tocitem" href="../tutorial_4/">4 Create a Model</a></li><li><a class="tocitem" href="../tutorial_5/">5 Monte Carlo + Sensitivity Analysis</a></li><li><a class="tocitem" href="../tutorial_6/">6 Create a Model with Composite Components</a></li></ul></li><li><span class="tocitem">How-to Guides</span><ul><li><a class="tocitem" href="../../howto/howto_main/">How-to Guides Intro</a></li><li><a class="tocitem" href="../../howto/howto_1/">1 Construct + Run a Model</a></li><li><a class="tocitem" href="../../howto/howto_2/">2 Explore Results</a></li><li><a class="tocitem" href="../../howto/howto_3/">3 Monte Carlo + SA</a></li><li><a class="tocitem" href="../../howto/howto_4/">4 Timesteps, Params, and Vars</a></li><li><a class="tocitem" href="../../howto/howto_5/">5 Port to v0.5.0</a></li><li><a class="tocitem" href="../../howto/howto_6/">6 Port to v1.0.0</a></li></ul></li><li><span class="tocitem">Advanced How-to Guides</span><ul><li><a class="tocitem" href="../../howto_advanced/howto_adv_main/">Advanced How-to Guides Intro</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_buildinit/">Build and Init Functions</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_datumrefs/">Using Datum References</a></li></ul></li><li><span class="tocitem">Reference Guides</span><ul><li><a class="tocitem" href="../../ref/ref_main/">Reference Guides Intro</a></li><li><a class="tocitem" href="../../ref/ref_API/">Mimi API</a></li><li><a class="tocitem" href="../../ref/ref_structures_classes_types/">Structures: Classes.jl and Types</a></li><li><a class="tocitem" href="../../ref/ref_structures_definitions/">Structures: Definitions</a></li><li><a class="tocitem" href="../../ref/ref_structures_instances/">Structures: Instances</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../../explanations/exp_main/">Explanations Intro</a></li><li><a class="tocitem" href="../../explanations/exp_pkgs/">Models as Packages</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>3 Modify an Existing Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>3 Modify an Existing Model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mimiframework/Mimi.jl/blob/master/docs/src/tutorials/tutorial_3.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial-3:-Modify-an-Existing-Model-1"><a class="docs-heading-anchor" href="#Tutorial-3:-Modify-an-Existing-Model-1">Tutorial 3: Modify an Existing Model</a><a class="docs-heading-anchor-permalink" href="#Tutorial-3:-Modify-an-Existing-Model-1" title="Permalink"></a></h1><p>This tutorial walks through the steps to modify an existing model.  There are several existing models publically available on Github, and for the purposes of this tutorial we will use the <code>MimiDICE2010</code> model.</p><p>Working through the following tutorial will require:</p><ul><li><a href="https://julialang.org/downloads/">Julia v1.4.0</a> or higher</li><li><a href="https://github.com/mimiframework/Mimi.jl">Mimi v0.10.0</a> or higher</li><li>connection of your julia installation with the central Mimi registry of Mimi models</li></ul><p>If you have not yet prepared these, go back to the first tutorial to set up your system.</p><p>Note that we have recently released Mimi v1.0.0, which is a breaking release and thus we cannot promise backwards compatibility with version lower than v1.0.0 although several of these tutorials may run properly with older versions. For assistance updating your own model to v1.0.0, or if you are curious about the primary changes made, see the How-to Guide on porting to Mimi v1.0.0. Mimi v0.10.0 is functionally dentical to Mimi v1.0.0, but includes deprecation warnings instead of errors to assist users in porting to v1.0.0.</p><h2 id="Introduction-1"><a class="docs-heading-anchor" href="#Introduction-1">Introduction</a><a class="docs-heading-anchor-permalink" href="#Introduction-1" title="Permalink"></a></h2><p>There are various ways to modify an existing model, and this tutorial aims to introduce the Mimi API relevant to this broad category of tasks.  It is important to note that regardless of the goals and complexities of your modifications, the API aims to allow for modification <strong>without alteration of the original code for the model being modified</strong>.  Instead, you will download and run the existing model, and then use API calls to modify it. This means that in practice, you should not need to alter the source code of the model you are modifying. Thus, it is easy to keep up with any external updates or improvements made to that model.</p><p>Possible modifications range in complexity, from simply altering parameter values, to adjusting an existing component, to adding a brand new component.</p><h2 id="Parametric-Modifications:-The-API-1"><a class="docs-heading-anchor" href="#Parametric-Modifications:-The-API-1">Parametric Modifications: The API</a><a class="docs-heading-anchor-permalink" href="#Parametric-Modifications:-The-API-1" title="Permalink"></a></h2><p>Several types of changes to models revolve around the parameters themselves, and may include updating the values of parameters and changing parameter connections without altering the elements of the components themselves or changing the general component structure of the model.  The most useful functions of the common API in these cases are likely <strong><a href="../../ref/ref_API/#Mimi.update_param!"><code>update_param!</code></a>/<a href="../../ref/ref_API/#Mimi.update_params!"><code>update_params!</code></a>, <a href="../../ref/ref_API/#Mimi.disconnect_param!"><code>disconnect_param!</code></a>, and <a href="../../ref/ref_API/#Mimi.connect_param!"><code>connect_param!</code></a></strong>.  For detail on these functions see the API reference guide, Reference Guide: The Mimi API.</p><p>When the original model calls <a href="../../ref/ref_API/#Mimi.set_param!"><code>set_param!</code></a>, Mimi creates an external parameter by the name provided, and stores the provided scalar or array value. The functions <a href="../../ref/ref_API/#Mimi.update_param!"><code>update_param!</code></a> and <a href="../../ref/ref_API/#Mimi.update_params!"><code>update_params!</code></a> allow you to change the value associated with this external parameter. </p><pre><code class="language-julia">update_param!(mymodel, :parametername, newvalues)</code></pre><p>Note here that <code>newvalues</code> must be the same type (or be able to convert to the type) of the old values stored in that parameter, and the same size as the model dimensions indicate. Also note that it if you have updated the time dimension of the model with <code>set_dimension!(m, :time, values)</code> you will need to update all parameters with a <code>:time</code> dimension, <strong>even if the values have not changed</strong>, so that the model can update the underlying time labels (ie. year labels) to match your new model time labels (ie. year labels).</p><p>If you wish to alter connections within an existing model, <a href="../../ref/ref_API/#Mimi.disconnect_param!"><code>disconnect_param!</code></a> and <a href="../../ref/ref_API/#Mimi.connect_param!"><code>connect_param!</code></a> can be used in conjunction with each other to update the connections within the model, although this is more likely to be done as part of larger changes involving components themslves, as discussed in the next subsection.</p><h2 id="Parametric-Modifications:-DICE-Example-1"><a class="docs-heading-anchor" href="#Parametric-Modifications:-DICE-Example-1">Parametric Modifications: DICE Example</a><a class="docs-heading-anchor-permalink" href="#Parametric-Modifications:-DICE-Example-1" title="Permalink"></a></h2><h4 id="Step-1.-Download-MimiDICE2010-1"><a class="docs-heading-anchor" href="#Step-1.-Download-MimiDICE2010-1">Step 1. Download MimiDICE2010</a><a class="docs-heading-anchor-permalink" href="#Step-1.-Download-MimiDICE2010-1" title="Permalink"></a></h4><p>The first step in this process is downloading the DICE2010 model, which is now made easy with the Mimi registry. Assuming you have already done the one-time run of the following to connect your julia installation with the central Mimi registry of Mimi models,</p><pre><code class="language-julia">pkg&gt; registry add https://github.com/mimiframework/MimiRegistry.git</code></pre><p>you simply need to add the MimiDICE2010 model in the Pkg REPL with:</p><pre><code class="language-julia">pkg&gt; add MimiDICE2010</code></pre><p>You have now successfully downloaded MimiDICE2010 to your local machine.</p><h4 id="Step-2.-Run-DICE-1"><a class="docs-heading-anchor" href="#Step-2.-Run-DICE-1">Step 2. Run DICE</a><a class="docs-heading-anchor-permalink" href="#Step-2.-Run-DICE-1" title="Permalink"></a></h4><p>The next step is to run DICE using the provided API for the package:</p><pre><code class="language-julia">using MimiDICE2010
m = MimiDICE2010.get_model()
run(m)</code></pre><p>These steps should be relatively consistent across models, where a repository for <code>ModelX</code> should contain a primary file <code>ModelX.jl</code> which exports, at minimum, a function named something like <code>get_model</code> or <code>construct_model</code> which returns a version of the model, and can allow for model customization within the call.</p><p>In this case, the function <code>MimiDICE2010.get_model()</code> has the signature</p><pre><code class="language-julia">get_model(params=nothing)</code></pre><p>Thus there are no required arguments, although the user can input <code>params</code>, a dictionary definining the parameters of the model. If nothing is provided, the model will be built with the default parameters for DICE2010.</p><h4 id="Step-3.-Altering-Parameters-1"><a class="docs-heading-anchor" href="#Step-3.-Altering-Parameters-1">Step 3. Altering Parameters</a><a class="docs-heading-anchor-permalink" href="#Step-3.-Altering-Parameters-1" title="Permalink"></a></h4><p>In the case that you wish to alter an exogenous parameter, you may use the <a href="../../ref/ref_API/#Mimi.update_param!"><code>update_param!</code></a> function.  Per usual, you will start by importing the Mimi package to your space with </p><pre><code class="language-julia">using Mimi</code></pre><p>In DICE the parameter <code>fco22x</code> is the forcings of equilibrium CO2 doubling in watts per square meter, and exists in the components <code>climatedynamics</code> and <code>radiativeforcing</code>.  We can change this value from its default value of <code>3.200</code> to <code>3.000</code> in both components, using the following code:</p><pre><code class="language-julia">update_param!(m, :fco22x, 3.000)
run(m)</code></pre><p>A more complex example may be a situation where you want to update several parameters, including some with a <code>:time</code> dimension, in conjunction with altering the time index of the model itself. DICE uses a default time horizon of 2005 to 2595 with 10 year increment timesteps.  If you wish to change this, say, to 2000 to 2500 by 10 year increment timesteps and use parameters that match this time, you could use the following code:</p><p>First you upate the <code>time</code> dimension of the model as follows:</p><pre><code class="language-julia">const ts = 10
const years = collect(2000:ts:2500)
nyears = length(years)
set_dimension!(m, :time, years)</code></pre><p>Now you must update at least all parameters with a <code>:time</code> dimension, even if the length and values remain the same, so that the underlying time labels (ie. year labels) update to match your new model time labels (ie. year labels).</p><p>Create a dictionary <code>params</code> with one entry <code>(k, v)</code> per external parameter by name <code>k</code> to value <code>v</code>. Each key <code>k</code> must be a symbol or convert to a symbol matching the name of an external parameter that already exists in the model definition.  Part of this dictionary may look like:</p><pre><code class="language-julia">params = Dict{Any, Any}()
params[:a1]         = 0.00008162
params[:a2]         = 0.00204626
...
params[:S]          = repeat([0.23], nyears)
...</code></pre><p>Now you simply update the parameters listen in <code>params</code> and re-run the model with</p><pre><code class="language-julia">update_params!(m, params)
run(m)</code></pre><h2 id="Component-and-Structural-Modifications:-The-API-1"><a class="docs-heading-anchor" href="#Component-and-Structural-Modifications:-The-API-1">Component and Structural Modifications: The API</a><a class="docs-heading-anchor-permalink" href="#Component-and-Structural-Modifications:-The-API-1" title="Permalink"></a></h2><p>Most model modifications will include not only parametric updates, but also structural changes and component modification, addition, replacement, and deletion along with the required re-wiring of parameters etc. The most useful functions of the common API, in these cases are likely <strong><a href="../../ref/ref_API/#Base.replace!"><code>replace!</code></a>, <a href="../../ref/ref_API/#Mimi.add_comp!"><code>add_comp!</code></a></strong> along with <strong><code>delete!</code></strong> and the requisite functions for parameter setting and connecting.  For detail on the public API functions look at the API reference. </p><p>If you wish to modify the component structure we recommend you also look into the <strong>built-in helper components <code>adder</code>, <code>ConnectorCompVector</code>, and <code>ConnectorCompMatrix</code></strong> in the <code>src/components</code> folder, as these can prove quite useful.  </p><ul><li><p><code>adder.jl</code> – Defines <code>Mimi.adder</code>, which simply adds two parameters, <code>input</code> and <code>add</code> and stores the result in <code>output</code>.</p></li><li><p><code>connector.jl</code> – Defines a pair of components, <code>Mimi.ConnectorCompVector</code> and <code>Mimi.ConnectorCompMatrix</code>. These copy the value of parameter <code>input1</code>, if available, to the variable <code>output</code>, otherwise the value of parameter <code>input2</code> is used. It is an error if neither has a value.</p></li></ul><h2 id="Component-and-Structural-Modifications:-DICE-Example-1"><a class="docs-heading-anchor" href="#Component-and-Structural-Modifications:-DICE-Example-1">Component and Structural Modifications: DICE Example</a><a class="docs-heading-anchor-permalink" href="#Component-and-Structural-Modifications:-DICE-Example-1" title="Permalink"></a></h2><p>This example is in progress and will be built out soon.</p><hr/><p>Next, feel free to move on to the next tutorial, which will go into depth on how to <strong>create</strong> your own model.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorial_2/">« 2 Run an Existing Model</a><a class="docs-footer-nextpage" href="../tutorial_4/">4 Create a Model »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 16 March 2021 20:10">Tuesday 16 March 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
