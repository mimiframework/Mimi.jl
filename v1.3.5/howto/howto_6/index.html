<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>6 Update Time Dimension · Mimi.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Mimi.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/tutorial_main/">Tutorials Intro</a></li><li><a class="tocitem" href="../../tutorials/tutorial_1/">1 Install Mimi</a></li><li><a class="tocitem" href="../../tutorials/tutorial_2/">2 Run an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_3/">3 Modify an Existing Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_4/">4 Create a Model</a></li><li><a class="tocitem" href="../../tutorials/tutorial_5/">5 Monte Carlo + Sensitivity Analysis</a></li><li><a class="tocitem" href="../../tutorials/tutorial_6/">6 Create a Model with Composite Components</a></li></ul></li><li><span class="tocitem">How-to Guides</span><ul><li><a class="tocitem" href="../howto_main/">How-to Guides Intro</a></li><li><a class="tocitem" href="../howto_1/">1 Construct + Run a Model</a></li><li><a class="tocitem" href="../howto_2/">2 Explore Results</a></li><li><a class="tocitem" href="../howto_3/">3 Monte Carlo + SA</a></li><li><a class="tocitem" href="../howto_4/">4 Timesteps</a></li><li><a class="tocitem" href="../howto_5/">5 Parameters + Variables</a></li><li class="is-active"><a class="tocitem" href>6 Update Time Dimension</a></li><li><a class="tocitem" href="../howto_7/">7 Port to v0.5.0</a></li><li><a class="tocitem" href="../howto_8/">8 Port to v1.0.0</a></li><li><a class="tocitem" href="../howto_9/">9 Port to New Param API</a></li></ul></li><li><span class="tocitem">Advanced How-to Guides</span><ul><li><a class="tocitem" href="../../howto_advanced/howto_adv_main/">Advanced How-to Guides Intro</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_buildinit/">Build and Init Functions</a></li><li><a class="tocitem" href="../../howto_advanced/howto_adv_datumrefs/">Using Datum References</a></li></ul></li><li><span class="tocitem">Reference Guides</span><ul><li><a class="tocitem" href="../../ref/ref_main/">Reference Guides Intro</a></li><li><a class="tocitem" href="../../ref/ref_API/">Mimi API</a></li><li><a class="tocitem" href="../../ref/ref_structures_classes_types/">Structures: Classes.jl and Types</a></li><li><a class="tocitem" href="../../ref/ref_structures_definitions/">Structures: Definitions</a></li><li><a class="tocitem" href="../../ref/ref_structures_instances/">Structures: Instances</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../../explanations/exp_main/">Explanations Intro</a></li><li><a class="tocitem" href="../../explanations/exp_pkgs/">Models as Packages</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to Guides</a></li><li class="is-active"><a href>6 Update Time Dimension</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>6 Update Time Dimension</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mimiframework/Mimi.jl/blob/master/docs/src/howto/howto_6.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-Guide-6:-Update-the-Time-Dimension-1"><a class="docs-heading-anchor" href="#How-to-Guide-6:-Update-the-Time-Dimension-1">How-to Guide 6: Update the Time Dimension</a><a class="docs-heading-anchor-permalink" href="#How-to-Guide-6:-Update-the-Time-Dimension-1" title="Permalink"></a></h1><p>A runnable model necessarily has a <code>time</code> dimension, originally set with the following call, but in some cases it may be desireable to alter this dimension by calling the following on a model which already has a time dimension set.</p><pre><code class="language-none">set_dimension!(m, :time, time_keys)</code></pre><hr/><h4 id="For-example,-one-may-wish-to-replace-the-FUND-model&#39;s-climate-module-with-a-different-one,-such-as-FAIR:-1"><a class="docs-heading-anchor" href="#For-example,-one-may-wish-to-replace-the-FUND-model&#39;s-climate-module-with-a-different-one,-such-as-FAIR:-1">For example, one may wish to replace the FUND model&#39;s climate module with a different one, such as FAIR:</a><a class="docs-heading-anchor-permalink" href="#For-example,-one-may-wish-to-replace-the-FUND-model&#39;s-climate-module-with-a-different-one,-such-as-FAIR:-1" title="Permalink"></a></h4><p>For the purposes of this guide we focus on the first step of such modification. Since FUND runs yearly from 1950 to 3000 and FAIR yearly from 1765 to 2500, our modified model will need to run yearly from 1765 to 1950.</p><p>We start with FUND</p><pre><code class="language-none">using Mimi
using MimiFUND
m = MimiFUND.get_model()</code></pre><p>where <code>MimiFUND.get_model</code> includes the call <code>set_dimension!(m, time, 1950:3000)</code>.</p><hr/><h4 id="Now-we-need-to-change-the-time-dimension-to-be-1765-to-2500:-1"><a class="docs-heading-anchor" href="#Now-we-need-to-change-the-time-dimension-to-be-1765-to-2500:-1">Now we need to change the <code>time</code> dimension to be 1765 to 2500:</a><a class="docs-heading-anchor-permalink" href="#Now-we-need-to-change-the-time-dimension-to-be-1765-to-2500:-1" title="Permalink"></a></h4><p>Before we do so, note some important rules and precautions. These are in place to avoid unexpected behavior, complications, or incorrect results caused by our under-the-hood assumptions, but if a use case arises where these are prohibitive please get in touch on the <a href="https://forum.mimiframework.org">forum</a> and we can help you out.</p><ul><li>The new time dimension cannot start later than the original time dimension.  </li><li>The new time dimension cannot end before the start of the original time dimension ie. it cannot completely exclude all times in the original time dimension.</li><li>The new time dimension must use the same timestep lengths as the original dimension.</li></ul><hr/><h4 id="We-now-go-ahead-and-change-the-time-dimension-to-be-1765-to-2500:-1"><a class="docs-heading-anchor" href="#We-now-go-ahead-and-change-the-time-dimension-to-be-1765-to-2500:-1">We now go ahead and change the <code>time</code> dimension to be 1765 to 2500:</a><a class="docs-heading-anchor-permalink" href="#We-now-go-ahead-and-change-the-time-dimension-to-be-1765-to-2500:-1" title="Permalink"></a></h4><pre><code class="language-none">set_dimension!(m, :time, 1765:2500)</code></pre><p>At this point the model <code>m</code> can be run, and will run from 1765 to 2500 (Try running it and looking at <code>explore(m)</code> for parameters and variables with a <code>time</code> dimension!). In fact, we could start adding FAIR components to the model, which would automatically take on the entire model time dimension, ie.</p><pre><code class="language-none">add_comp!(m, FAIR_component) # will run from 1765 to 1950</code></pre><p><strong>However</strong>, the FUND components will only run in the subset of years 1950 to 2500, using the same parameter values each year was previously associated with, and containing placeholder <code>missing</code> values in the parameter value spots from 1765 to 1949. More specifically:</p><ul><li>The model&#39;s <code>time</code> dimension values are updated, and it will run for each year in the new 1765:1950 dimension.   <code>julia&gt; Mimi.time_labels(m)   736-element Vector{Int64}: [1765, 1766, 1767,  …  2498, 2499, 2500]</code></li><li>The components <code>time</code> dimension values are updated, but (1) the components maintain the <code>first</code> year as set implicitly by the original <code>time</code> dimension (1950) so the run period start year does not change and (2) they maintain their <code>last</code> year as set implicitly by the original <code>time</code> dimension, unless that year is now later than the model&#39;s last year, in which case it is trimmed back to the <code>time</code> dimensions last year (2500).  Thus, the components will run for the same run period, or a shorter one if the new time dimension ends before the component used to (in this case 1950:2500).   <code>julia&gt; component = m.md.namespace[:emissions] # get component def(ignore messy internals syntax)   julia&gt; component.dim_dict[:time]   [1765, 1766, 1767,  …  2498, 2499, 2500]   julia&gt; component.first   1950   julia&gt; component.last   2500</code></li><li>All model parameters are trimmed and padded as needed so the model can still run, <strong>and the values are still linked to their original years</strong>.  More specifically, if the new time dimension ends earlier than the original one than the parameter value vector/matrix is trimmed at the end.  If the new time dimension starts earlier than the original, or ends later, the parameter values are padded with <code>missing</code>s at the front and/or back respectively.   <code>julia&gt; parameter_values = Mimi.model_params(m)[:currtaxn2o].values.data # get param values for use in next run (ignore messy internals syntax)   julia&gt; size(parameter_values)   (736, 16)   julia&gt; parameter_values[1:(1950-1765),:] # all missing   julia&gt; parameter_values[(1950-1764),:] # hold set values</code></li></ul><hr/><h4 id="The-following-options-are-now-available-for-further-modifcations-if-this-end-state-is-not-desireable:-1"><a class="docs-heading-anchor" href="#The-following-options-are-now-available-for-further-modifcations-if-this-end-state-is-not-desireable:-1">The following options are now available for further modifcations if this end state is not desireable:</a><a class="docs-heading-anchor-permalink" href="#The-following-options-are-now-available-for-further-modifcations-if-this-end-state-is-not-desireable:-1" title="Permalink"></a></h4><ul><li>If you want to update a component&#39;s run period, you may use the function <code>Mimi.set_first_last!(m, :ComponentName, first = new_first, last = new_last)</code> to specify when you want the component to run.</li><li>You can update shared model parameters to have values in place of the assumed <code>missing</code>s using the <a href="../../ref/ref_API/#Mimi.update_param!"><code>update_param!</code></a> function </li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../howto_5/">« 5 Parameters + Variables</a><a class="docs-footer-nextpage" href="../howto_7/">7 Port to v0.5.0 »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 22 October 2021 03:07">Friday 22 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
